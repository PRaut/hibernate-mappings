var formToValidate=$("#loginForm").validate({rules:{loginUsername:{required:!0,minlength:3},loginPassword:{required:!0,minlength:3}},messages:{loginUsername:{required:'<span style="color:red">Please enter your username<span>',minlength:'<span style="color:red">Please enter a valid username<span>'},loginPassword:{required:'<span style="color:red">Please enter your password<span>',minlength:'<span style="color:red">Please enter a valid password<span>'}}});function doMag(e){var t,a=CryptoJS.enc.Utf8.parse("rTg"+e),o=CryptoJS.enc.Utf8.parse(e+"cgf"),n=(t=$("#loginPassword").val(),CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(t),a,{keySize:16,iv:o,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}));$("#loginPassword").val(n)}function checkUser(){var e={};document.cookie.split(";",5).forEach(function(t){var a=t.split("=",2);e[a[0].trim()]=a[1]}),$.ajax({url:"api/users/getUserDetails",type:"GET",headers:{"content-type":"application/json",Authorization:"Token "+e["access-token"]},success:function(e){window.location.href="/lhops"},error:function(e){$("#loginMessage").html("<div class='alert alert-danger'>Please login to continue</div>")}})}$("#portSelect").submit(function(e){e.preventDefault();var t=$("#portSelect").find("input[name=mod_select]:checked").val();"umg"==t?window.location.href="usermanagement":"lhop"==t&&(window.location.href="/lhops")}),$("#loginForm").submit(function(e){if($("#loginMessage").html(""),formToValidate.valid()){var t=$("#loginButton");t.button("loading"),e.preventDefault(),radio=(new Date).getTime(),doMag(radio);var a={username:$("#loginUsername").val(),password:$("#loginPassword").val()},o=$.ajax({url:"login",type:"POST",data:JSON.stringify(a),headers:{"content-type":"application/json",radio:radio},success:function(e){null!=e.serviceResponse?(document.cookie="access-token="+e.serviceResponse.token+"; Path=/",t.button("reset"),text="login successful",clearInterval(loadInterval),window.location.href="/lhops"):($("#loginMessage").html("<div class='alert alert-danger'>Provided credentials are not listed. Please contact administrator</div>"),text="",$("#loginPassword").val("")),t.button("reset"),text="",clearInterval(loadInterval)},error:function(e,a){console.log(e),$("#loginMessage").html("<div class='alert alert-danger'>Login failed</div>"),t.button("reset"),clearInterval(loadInterval),text="",$("#loginPassword").val("")}});i=0,totalSecs=0,interValTime=200,text="contacting server ",loadInterval=setInterval(function(){$("#subMessage").html(text+Array(++i%4+1).join(".")),totalSecs+=interValTime,totalSecs>15e3&&(text="attempting login "),totalSecs>3e4&&(text="attempting login, please wait "),totalSecs>45e3&&(text="<span style='color: red'>The server took too long to respond, please try again. If you've seen this message repeatedly please contact the administrator</span>",$("#subMessage").html(text),$("#loginMessage").html("<div class='alert alert-danger'>Login failed</div>"),clearInterval(loadInterval),t.button("reset"),o.abort(),$("#loginPassword").val(""))},interValTime)}});var cookieData={},splittedCookie=document.cookie.split(";",5);splittedCookie.forEach(function(e){var t=e.split("=",2);cookieData[t[0].trim()]=t[1]});var accessToken=cookieData["access-token"];null!=accessToken&&accessToken.length&&checkUser();